!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("sails.io.js"),require("socket.io-client"),require("@angular/core"),require("rxjs"),require("json-object-mapper"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","sails.io.js","socket.io-client","@angular/core","rxjs","json-object-mapper","rxjs/operators"],e):e((t.ng=t.ng||{},t.ng.amazing={}),null,null,t.ng.core,null,null,null)}(this,function(t,c,h,e,r,i,n){"use strict";c=c&&c.hasOwnProperty("default")?c.default:c;var s=(o.prototype.isOk=function(){return 200<=this.getStatusCode()&&this.getStatusCode()<300},o.prototype.isCreated=function(){return 201===this.getStatusCode()},o.prototype.isUnauthorized=function(){return 401===this.getStatusCode()},o.prototype.isForbidden=function(){return 403===this.getStatusCode()},o.prototype.isNotFound=function(){return 404===this.getStatusCode()},o.prototype.isBadRequest=function(){return 400===this.getStatusCode()},o.prototype.isError=function(){return this.isClientError()||this.isServerError()},o.prototype.isClientError=function(){return 400<=this.getStatusCode()&&!this.isServerError()},o.prototype.isServerError=function(){return 500<=this.getStatusCode()},o.prototype.getCode=function(){return this.getBody().code},o.prototype.getData=function(){return this.getBody().data||this.getBody()},o.prototype.getMessage=function(){return this.getBody().message},o.prototype.getBody=function(){return this.JWR.body},o.prototype.getHeaders=function(){return this.JWR.headers},o.prototype.getError=function(){return this.JWR.error},o.prototype.getStatusCode=function(){return this.JWR.statusCode},o.prototype.pipe=function(){return this.JWR.pipe()},o.prototype.toPOJO=function(){return this.JWR.toPOJO()},o.prototype.toString=function(){return this.JWR.toString()},o);function o(t){this.JWR=t}var p=function(t){this.url="ws://localhost:1337",this.query="__sails_io_sdk_version=0.11.0&__sails_io_sdk_platform=windows&__sails_io_sdk_language=javascript",this.reconnection=!0,this.autoConnect=!0,this.transports=["websocket"],this.useCORSRouteToGetCookie=!1,this.headers={},this.timeout=2e4,this.path="",this.prefix="",Object.assign(this,t)},a=(u.prototype.handle=function(t){return this.interceptor.intercept(t,this.next)},u);function u(t,e){this.next=t,this.interceptor=e}function f(t){return void 0===t}function d(t){return"string"==typeof t}function l(t){return!Object.keys(t).length}function y(t){return t instanceof Object}var E={CREATED:"created",UPDATED:"updated",ADDED:"added",DESTROYED:"destroyed",REMOVED:"removed"},g=(C.prototype.isCreated=function(){return this.getVerb()===E.CREATED},C.prototype.isUpdated=function(){return this.getVerb()===E.UPDATED},C.prototype.isDestroyed=function(){return this.getVerb()===E.DESTROYED},C.prototype.isAdded=function(){return this.getVerb()===E.ADDED},C.prototype.isRemoved=function(){return this.getVerb()===E.REMOVED},C.prototype.getVerb=function(){return this.JWR.verb},C.prototype.getData=function(){return this.JWR.data},C.prototype.getId=function(){return this.JWR.id},C.prototype.hasAck=function(){return!!this.ack},C.prototype.acknowledge=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return!!this.ack&&(this.ack.apply(this,t),!0)},C);function C(t,e){this.JWR=t,this.ack=e}var O=new e.InjectionToken("SAILS_OPTIONS"),m=new e.InjectionToken("SAILS_INTERCEPTORS"),R={DEV:"development",PROD:"production"},w={ERROR:"error",CONNECT:"connect",RECONNECT:"reconnect",CONNECTING:"connecting",DISCONNECT:"disconnect",RECONNECTING:"reconnecting",CONNECT_ERROR:"connect_error",CONNECT_TIMEOUT:"connect_timeout"},b=(Object.defineProperty(v.prototype,"socket",{get:function(){return this.Socket},set:function(t){this.Socket=t},enumerable:!0,configurable:!0}),v.prototype.getSocketRaw=function(){return this.socket._raw?this.socket._raw:null},v.prototype.connect=function(){return this.connected()||this.socket._connect(),this},v.prototype.connected=function(){return this.socket.isConnected()},v.prototype.isConnecting=function(){return this.socket.isConnecting(),this},v.prototype.disconnect=function(){return this.connected()&&this.socket.disconnect(),this},v.prototype.addEventListener=function(t,e){if(!this.Listeners[t])throw new Error("The event ["+t+"] has not yet been supported by this library.");return this.Listeners[t].push(e),this},v.prototype.removeEventListener=function(t,e){if(!this.Listeners[t])throw new Error("The event ["+t+"] has not yet been supported by this library.");return-1<this.Listeners[t].indexOf(e)&&this.Listeners[t].splice(this.Listeners[t].indexOf(e),1),this},v.prototype.on=function(n){var o=this;return new r.Observable(function(i){return o.socket.on(n,function(t,e){if(t){var r=new g(t,e);i.next(r),o.debugReqRes(n,r)}}),function(){return o.socket.off(n,function(){})}})},v.prototype.off=function(i){var n=this;return new r.Observable(function(r){n.socket.off(i,function(t){if(t){var e=new g(t);r.next(e),n.debugReqRes(i,e)}return function(){}})})},v.prototype.request=function(t){var e=t.clone({url:this.Config.prefix+t.url});return this.intercept(e)},v.prototype.intercept=function(t,e){var r=this;return void 0===e&&(e=this),this.Interceptors.reduceRight(function(t,e){return new a(t,r.injector.get(e))},e).handle(t)},v.prototype.handle=function(n){var o=this;return new r.Observable(function(i){o.socket.request(n.serialize(),function(t,e){var r=new s(e);r.isError()?i.error(r.getError()):i.next(r),i.complete(),o.debugReqRes(n,r)})})},v.prototype.debugReqRes=function(t,e){this.Config.environment===R.DEV&&(console.groupCollapsed("[SailsSocketIO] > Debug Output"),d(t)?console.log(t):console.dir(t),console.dir(e),console.groupEnd())},v.ctorParameters=function(){return[{type:e.Injector,decorators:[{type:e.Inject,args:[e.Injector]}]},{type:void 0,decorators:[{type:e.Inject,args:[O]}]},{type:Array,decorators:[{type:e.Inject,args:[m]}]}]},v);function v(t,e,r){var i;void 0===r&&(r=[]);var n=this;this.injector=t,this.Interceptors=r,this.Listeners=((i={})[w.CONNECT]=[],i[w.CONNECT_ERROR]=[],i[w.CONNECT_TIMEOUT]=[],i[w.CONNECTING]=[],i[w.RECONNECT]=[],i[w.RECONNECTING]=[],i[w.DISCONNECT]=[],i[w.ERROR]=[],i);function o(t){return function(e){n.Listeners[t].forEach(function(t){return t(e)})}}var s=c(h),a=s.socket;a.on(w.CONNECT,o(w.CONNECT)),a.on(w.CONNECT_ERROR,o(w.CONNECT_ERROR)),a.on(w.CONNECT_TIMEOUT,o(w.CONNECT_TIMEOUT)),a.on(w.CONNECTING,o(w.CONNECTING)),a.on(w.RECONNECT,o(w.RECONNECT)),a.on(w.ERROR,o(w.ERROR)),a.on(w.RECONNECTING,o(w.RECONNECTING)),a.on(w.DISCONNECT,o(w.DISCONNECT));var u=new p(e);Object.assign(s.sails,u),this.socket=a,this.Config=u}function N(t,e){return i.ObjectMapper.deserialize(t,e)}function T(e){return void 0===e&&(e=""),function(t){t.prototype.getEndPoint=function(){return e}}}var S,q=function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,r,s):n(e,r))||s);return 3<o&&s&&Object.defineProperty(e,r,s),s},D=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},k=((S=P).prototype.getEndPoint=function(){return this.getEndPoint()},P.serialize=function(t){return function(t){for(var e in t){var r=t[e];null!==r&&"function"!=typeof r||delete t[e],r&&r instanceof S&&null!==r.id&&(t[e]=r.id),r&&r instanceof S&&(t[e]=S.serialize(r)),r&&r instanceof Array&&(t[e]=r.map(function(t){return t instanceof S?S.serialize(t):t}))}return t}(Object.assign({},t))},P.unserialize=function(e,t){function r(t){return N(e,t)}if(Array.isArray(t))return t.map(r);if(y(t))return r(t);throw new Error("SailsModel.unserialize requires a data parameter of either a Literal Object or an Array of Literal Objects")},q([i.JsonProperty(),D("design:type",String)],P.prototype,"id",void 0),q([i.JsonProperty({type:Date}),D("design:type",Date)],P.prototype,"createdAt",void 0),q([i.JsonProperty({type:Date}),D("design:type",Date)],P.prototype,"updatedAt",void 0),P=S=q([T()],P));function P(){this.id=""}var j=(I.prototype.clone=function(t){for(var e in t)this.options.hasOwnProperty(e)&&t[e]||delete t[e];return Object.assign(this.options,t),this},I.prototype.toMap=function(e){void 0===e&&(e={});var r=new Map;return Object.keys(e).forEach(function(t){return r.set(t,e[t])}),r},I.prototype.toObject=function(t){void 0===t&&(t=new Map);var r={};return t.forEach(function(t,e){return r[e]=t}),r},Object.defineProperty(I.prototype,"method",{get:function(){return this.options.method},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"url",{get:function(){return this.options.url},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"params",{get:function(){return this.options.params},enumerable:!0,configurable:!0}),Object.defineProperty(I.prototype,"headers",{get:function(){return this.options.headers},enumerable:!0,configurable:!0}),I.prototype.serialize=function(){return{url:this.url,method:this.method,params:this.toObject(this.params),headers:this.toObject(this.headers)}},I);function I(t){var e=t.url,r=t.method,i=t.params,n=t.headers;this.options={url:e,method:r,params:this.toMap(i),headers:this.toMap(n)}}var _=(A.prototype.append=function(t){return"string"==typeof t&&(this.query.length&&(this.query+="&"),this.query+=t),this},A.prototype.toString=function(){return this.query&&"?"!==this.query.charAt(0)&&(this.query="?"+this.query),this.query},A);function A(t){void 0===t&&(t=""),this.query=t}var M={GET:"get",POST:"post",PUT:"put",DELETE:"delete",PATCH:"patch"},L=(z.prototype.get=function(t,e,r){return this._request(M.GET,t,e,r)},z.prototype.post=function(t,e,r){return this._request(M.POST,t,e,r)},z.prototype.put=function(t,e,r){return this._request(M.PUT,t,e,r)},z.prototype.delete=function(t,e){return this._request(M.DELETE,t,e)},z.prototype.patch=function(t,e){return this._request(M.PATCH,t,e)},z.prototype._request=function(t,e,r,i){var n=new j({method:t,url:this.buildQuery(e),params:r,headers:i});return this.sails.request(n)},z.prototype.addParam=function(t,e){return e.toString().length&&this.parameters.push(t+"="+e),this},z.prototype.getParams=function(){return this.parameters.join("&")},z.prototype.buildQuery=function(t){return t+new _(this.getParams())},z);function z(t){this.sails=t,this.parameters=[]}var W=(J.prototype.or=function(){return f(this.orCriteria.or)?this.orCriteria.or=[this.criteria]:Array.isArray(this.orCriteria.or)?this.orCriteria.or.push(this.criteria):y(this.criteria.or)&&(this.orCriteria.or=[this.criteria]),this.criteria={},this},J.prototype.whereNotEqualTo=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={"!":e},this;if(f(this.criteria[t]["!"]))return this.criteria[t]["!"]=e,this;throw new Error("DuplicateError: ! clause, use whereNotIn instead")},J.prototype.whereLike=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={like:e},this;if(f(this.criteria[t].like))return this.criteria[t].like=e,this;throw new Error("DuplicateError: like clause has already been used in this query")},J.prototype.whereEqualTo=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]=e,this;throw new Error("DuplicateError: contains clause has already been used in this query")},J.prototype.whereContains=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={contains:e},this;if(f(this.criteria[t].contains))return this.criteria[t].contains=e,this;throw new Error("DuplicateError: contains clause has already been used in this query")},J.prototype.whereIn=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]=e,this;throw new Error("DuplicateError: contains clause has already been used in this query")},J.prototype.whereStartsWith=function(t,e){if(d(this.criteria[t]))return this.criteria[t]={startsWith:e},this;if(f(this.criteria[t].startsWith))return this.criteria[t].startsWith=e,this;throw new Error("DuplicateError: startsWith clause has already been used in this query")},J.prototype.whereEndsWith=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={endsWith:e},this;if(f(this.criteria[t].endsWith))return this.criteria[t].endsWith=e,this;throw new Error("DuplicateError: endsWith clause has already been used in this query")},J.prototype.whereNotIn=function(t,e){return f(this.criteria[t])||d(this.criteria[t])?this.criteria[t]={"!":[e]}:f(this.criteria[t]["!"])?this.criteria[t]["!"]=[e]:Array.isArray(this.criteria[t]["!"])?this.criteria[t]["!"].push(e):this.criteria[t]["!"]=[this.criteria[t]["!"],e],this},J.prototype.whereLessThan=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={"<":e},this;if(f(this.criteria[t]["<"]))return this.criteria[t]["<"]=e,this;throw new Error("DuplicateError: < clause has already been used in this query")},J.prototype.whereLessThanOrEqualTo=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={"<=":e},this;if(f(this.criteria[t]["<="]))return this.criteria[t]["<="]=e,this;throw new Error("DuplicateError: <= clause has already been used in this query")},J.prototype.whereGreaterThan=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={">":e},this;if(f(this.criteria[t][">"]))return this.criteria[t][">"]=e,this;throw new Error("DuplicateError: > clause has already been used in this query")},J.prototype.whereGreaterThanOrEqualTo=function(t,e){if(f(this.criteria[t])||d(this.criteria[t]))return this.criteria[t]={">=":e},this;if(f(this.criteria[t][">="]))return this.criteria[t][">="]=e,this;throw new Error("DuplicateError: >= clause has already been used in this query")},J.prototype.build=function(){if(l(this.criteria))return"";function t(t){return JSON.stringify(t)}return l(this.orCriteria)?t(this.criteria):(Array.isArray(this.orCriteria.or)&&this.orCriteria.or.push(this.criteria),t(this.orCriteria))},J.prototype.toString=function(){return this.build()},J);function J(){this.criteria={},this.orCriteria={}}var x=(G.prototype.find=function(){var e=this;return this.request.addParam("where",this.getRequestCriteria()),this.request.get("/"+this.model.getEndPoint()).pipe(n.map(function(t){if(t.isOk())return k.unserialize(e.modelClass,t.getData());throw t}))},G.prototype.findById=function(t){var e=this;return this.request.addParam("where",this.getRequestCriteria()),this.request.get("/"+this.model.getEndPoint()+"/"+t).pipe(n.map(function(t){if(t.isOk())return k.unserialize(e.modelClass,t.getData());throw t}))},G.prototype.save=function(t){var e=this;if(!(t instanceof this.modelClass))throw new TypeError(this.errorMsg);var r=k.serialize(t),i="/"+t.getEndPoint();return null===t.id?this.request.post(i,r).pipe(n.map(function(t){if(t.isOk())return k.unserialize(e.modelClass,t.getData());throw t})):this.request.put(i.concat("/",t.id),r).pipe(n.map(function(t){if(t.isOk())return k.unserialize(e.modelClass,t.getData());throw t}))},G.prototype.update=function(t,e){var r=this;e.createdAt&&delete e.createdAt,e.updatedAt&&delete e.updatedAt;var i=e instanceof k?k.serialize(e):Object.assign({},e);return this.request.put("/"+this.model.getEndPoint()+"/"+t,i).pipe(n.map(function(t){if(t.isOk())return k.unserialize(r.modelClass,t.getData());throw t}))},G.prototype.remove=function(t){var e=this;return this.request.delete("/"+this.model.getEndPoint()+"/"+t).pipe(n.map(function(t){if(t.isOk())return k.unserialize(e.modelClass,t.getData());throw t}))},G.prototype.setLimit=function(t){return this.request.addParam("limit",t),this},G.prototype.setSort=function(t){return this.request.addParam("sort",t),this},G.prototype.setSkip=function(t){return this.request.addParam("skip",t),this},G.prototype.setPopulation=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this.request.addParam("populate","["+t.join(",")+"]"),this},G.prototype.setRequestCriteria=function(t){return this.criteria=t,this},G.prototype.getRequestCriteria=function(){return this.criteria||new W},G);function G(t,e){this.modelClass=e,this.errorMsg="[SailsSocketIO]: the data is not an instance of "+this.modelClass.name+".\n        You could SailsModel.unserialize("+this.modelClass.name+", data) as "+this.modelClass.name+"[] (Array of Models), Or\n        SailsModel.unserialize("+this.modelClass.name+", data) as "+this.modelClass.name+" (Single Models)\n        after fetching the data with SailsRequest.",this.request=new L(t),this.model=new e}var V=(U.forRoot=function(t,e){return void 0===e&&(e=[]),{ngModule:U,providers:[b].concat(e,[{provide:O,useValue:t},{provide:m,useValue:e}])}},U.decorators=[{type:e.NgModule}],U);function U(){}var B=(H.prototype.on=function(t){return this.sails.on(t.toLowerCase())},H.prototype.off=function(t){return this.sails.off(t.toLowerCase())},H);function H(t){this.sails=t}t.Ignore=i.JsonIgnore,t.Property=i.JsonProperty,t.SAILS_OPTIONS=O,t.SAILS_INTERCEPTORS=m,t.SailsEnvironment=R,t.SailsListener=w,t.Sails=b,t.SailsModel=k,t.SailsQuery=x,t.SailsModule=V,t.Method=M,t.SailsRequest=L,t.SailsSubscription=B,t.SailsResponse=s,t.Verb=E,t.SailsEvent=g,t.unserialize=N,t.serialize=function(t){return i.ObjectMapper.serialize(t)},t.SailsRequestOptions=j,t.RequestCriteria=W,t.Endpoint=T,t.SailsInterceptorHandler=a,Object.defineProperty(t,"__esModule",{value:!0})});